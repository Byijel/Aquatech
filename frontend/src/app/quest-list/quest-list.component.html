<div class="underwater-background">
  <div class="caustic-light"></div>
  
  <div class="light-ray"></div>
  <div class="light-ray"></div>
  <div class="light-ray"></div>
  <div class="light-ray"></div>
  <div class="light-ray"></div>
  
  <div *ngFor="let i of particles" class="particle" [ngStyle]="i"></div>
  
  <div class="fish fish-1" style="top: 15%">
    <svg width="70" height="45" viewBox="0 0 70 45" fill="none">
      <ellipse cx="35" cy="22" rx="22" ry="13" fill="#4ECCA3" />
      <path d="M 13 22 L 4 14 L 4 30 Z" fill="#3DBDA0" />
      <circle cx="48" cy="18" r="2.5" fill="#2A5F6B" />
    </svg>
  </div>
  <div class="fish fish-2" style="top: 45%">
    <svg width="60" height="40" viewBox="0 0 60 40" fill="none">
      <ellipse cx="30" cy="20" rx="20" ry="12" fill="#67D5ED" />
      <path d="M 10 20 L 2 12 L 2 28 Z" fill="#5BC5DB" />
      <circle cx="42" cy="16" r="2" fill="#2A5F6B" />
    </svg>
  </div>
  <div class="fish fish-3" style="top: 72%">
    <svg width="65" height="42" viewBox="0 0 65 42" fill="none">
      <ellipse cx="32" cy="21" rx="21" ry="13" fill="#52B788" />
      <path d="M 11 21 L 3 14 L 3 28 Z" fill="#40916C" />
      <circle cx="45" cy="18" r="2.5" fill="#2A5F6B" />
    </svg>
  </div>
  <div class="fish fish-4" style="top: 25%">
    <svg width="55" height="35" viewBox="0 0 55 35" fill="none">
      <ellipse cx="28" cy="18" rx="18" ry="11" fill="#FFB76B" />
      <path d="M 10 18 L 3 12 L 3 24 Z" fill="#FF9A4D" />
      <circle cx="38" cy="15" r="2" fill="#2A5F6B" />
    </svg>
  </div>
  <div class="fish fish-5" style="top: 58%">
    <svg width="58" height="38" viewBox="0 0 58 38" fill="none">
      <ellipse cx="29" cy="19" rx="19" ry="12" fill="#A6E3E9" />
      <path d="M 10 19 L 3 13 L 3 25 Z" fill="#71C9CE" />
      <circle cx="41" cy="16" r="2" fill="#2A5F6B" />
    </svg>
  </div>

  <div class="jellyfish" style="top: 25%; left: 65%">
    <svg width="60" height="80" viewBox="0 0 60 80" fill="none">
      <ellipse cx="30" cy="25" rx="20" ry="18" fill="#6DD5ED" opacity="0.8" />
      <ellipse cx="30" cy="25" rx="15" ry="13" fill="#7DE2F5" opacity="0.6" />
      <path d="M 20 40 Q 18 55 15 70" stroke="#5BC8DB" stroke-width="2" fill="none" opacity="0.7" />
      <path d="M 25 42 Q 23 60 22 75" stroke="#5BC8DB" stroke-width="2" fill="none" opacity="0.7" />
      <path d="M 30 43 Q 30 58 28 73" stroke="#5BC8DB" stroke-width="2" fill="none" opacity="0.7" />
      <path d="M 35 42 Q 37 60 38 75" stroke="#5BC8DB" stroke-width="2" fill="none" opacity="0.7" />
      <path d="M 40 40 Q 42 55 45 70" stroke="#5BC8DB" stroke-width="2" fill="none" opacity="0.7" />
      <circle cx="30" cy="20" r="2" fill="#FFFFFF" opacity="0.8" />
      <circle cx="25" cy="25" r="1.5" fill="#FFFFFF" opacity="0.6" />
      <circle cx="35" cy="25" r="1.5" fill="#FFFFFF" opacity="0.6" />
    </svg>
  </div>
  <div class="jellyfish" style="top: 58%; left: 15%">
    <svg width="55" height="75" viewBox="0 0 55 75" fill="none">
      <ellipse cx="28" cy="23" rx="18" ry="16" fill="#B4A7F5" opacity="0.8" />
      <ellipse cx="28" cy="23" rx="13" ry="11" fill="#C7BBF8" opacity="0.6" />
      <path d="M 18 38 Q 16 51 13 65" stroke="#9B8EE3" stroke-width="2" fill="none" opacity="0.7" />
      <path d="M 23 40 Q 21 56 20 70" stroke="#9B8EE3" stroke-width="2" fill="none" opacity="0.7" />
      <path d="M 28 41 Q 28 54 26 68" stroke="#9B8EE3" stroke-width="2" fill="none" opacity="0.7" />
      <path d="M 33 40 Q 35 56 36 70" stroke="#9B8EE3" stroke-width="2" fill="none" opacity="0.7" />
      <path d="M 38 38 Q 40 51 43 65" stroke="#9B8EE3" stroke-width="2" fill="none" opacity="0.7" />
    </svg>
  </div>
</div>

<div class="underwater-floor">
  <div class="floor-gradient"></div>
  <div class="coral-container">
    <svg class="seaweed" width="80" height="200" viewBox="0 0 80 200" fill="none">
      <path d="M 30 200 Q 25 170 30 140 Q 35 110 28 80 Q 25 50 30 20" stroke="#2D5F4E" stroke-width="12" fill="none" stroke-linecap="round" />
      <path d="M 50 200 Q 55 165 50 130 Q 45 95 52 60 Q 55 30 50 10" stroke="#3A7A63" stroke-width="10" fill="none" stroke-linecap="round" />
      <ellipse cx="20" cy="120" rx="8" ry="15" fill="#2D5F4E" opacity="0.7" transform="rotate(-20 20 120)" />
      <ellipse cx="60" cy="100" rx="8" ry="15" fill="#3A7A63" opacity="0.7" transform="rotate(20 60 100)" />
    </svg>
    
    <svg class="coral" width="120" height="180" viewBox="0 0 120 180" fill="none">
      <ellipse cx="60" cy="170" rx="50" ry="15" fill="#0f2027" />
      <path d="M 40 170 Q 35 140 30 100 Q 28 80 25 60" stroke="#8B4789" stroke-width="8" fill="none" stroke-linecap="round" opacity="0.8" />
      <path d="M 60 170 Q 58 130 55 80 Q 52 55 48 30" stroke="#A6699A" stroke-width="10" fill="none" stroke-linecap="round" opacity="0.9" />
      <path d="M 80 170 Q 82 135 85 90 Q 88 65 92 40" stroke="#8B4789" stroke-width="7" fill="none" stroke-linecap="round" opacity="0.75" />
      <circle cx="25" cy="60" r="6" fill="#B47FA8" opacity="0.6" />
      <circle cx="48" cy="30" r="7" fill="#B47FA8" opacity="0.6" />
      <circle cx="92" cy="40" r="6" fill="#B47FA8" opacity="0.6" />
    </svg>
    
    <svg class="seaweed" width="70" height="190" viewBox="0 0 70 190" fill="none">
      <path d="M 25 190 Q 30 160 25 130 Q 20 100 28 70 Q 30 40 25 15" stroke="#2D5F4E" stroke-width="10" fill="none" stroke-linecap="round" />
      <path d="M 45 190 Q 40 155 45 120 Q 50 85 43 50 Q 40 25 45 5" stroke="#3A7A63" stroke-width="9" fill="none" stroke-linecap="round" />
    </svg>
    
    <svg class="coral" width="140" height="160" viewBox="0 0 140 160" fill="none">
      <ellipse cx="70" cy="155" rx="55" ry="12" fill="#0f2027" />
      <path d="M 70 155 Q 50 130 40 100 L 40 100 Q 55 105 70 100 Q 85 105 100 100 Q 90 130 70 155" fill="#C95D63" opacity="0.7" />
      <path d="M 70 155 Q 55 135 48 110 L 48 110 Q 60 112 70 108 Q 80 112 92 110 Q 85 135 70 155" fill="#D67A7A" opacity="0.6" />
    </svg>
    
    <svg class="seaweed" width="60" height="220" viewBox="0 0 60 220" fill="none">
      <path d="M 30 220 Q 25 180 30 140 Q 35 100 28 60 Q 25 30 30 10" stroke="#2D5F4E" stroke-width="11" fill="none" stroke-linecap="round" />
      <ellipse cx="20" cy="150" rx="8" ry="14" fill="#2D5F4E" opacity="0.7" transform="rotate(-15 20 150)" />
      <ellipse cx="40" cy="130" rx="8" ry="14" fill="#3A7A63" opacity="0.7" transform="rotate(15 40 130)" />
    </svg>
    
    <svg class="coral" width="100" height="130" viewBox="0 0 100 130" fill="none">
      <ellipse cx="50" cy="125" rx="40" ry="10" fill="#0f2027" />
      <circle cx="35" cy="100" r="18" fill="#4A7C8C" opacity="0.7" />
      <circle cx="30" cy="95" r="12" fill="#5A8C9C" opacity="0.6" />
      <circle cx="65" cy="105" r="20" fill="#4A7C8C" opacity="0.7" />
      <circle cx="70" cy="98" r="12" fill="#6A9CAC" opacity="0.6" />
    </svg>
    
    <svg class="seaweed" width="75" height="180" viewBox="0 0 75 180" fill="none">
      <path d="M 35 180 Q 30 150 35 120 Q 40 90 33 60 Q 30 30 35 10" stroke="#2D5F4E" stroke-width="10" fill="none" stroke-linecap="round" />
      <ellipse cx="25" cy="100" rx="7" ry="13" fill="#2D5F4E" opacity="0.7" transform="rotate(-20 25 100)" />
      <ellipse cx="45" cy="70" rx="7" ry="13" fill="#3A7A63" opacity="0.7" transform="rotate(20 45 70)" />
    </svg>
  </div>
</div>

<div class="page-container">
  <header class="header">
    <h1 class="title">AQUATOPIA</h1>
  </header>

  <main class="content">
    <div *ngIf="!loading && problem.length > 0; else loadingTemplate" class="challenges-grid">
      <div *ngFor="let problem of problem" class="challenge-card" [class.expanded]="problem.expanded" (click)="toggleExpanded(problem)">
        <div class="card-pattern"></div>
        
        <div class="card-header">
          <div class="card-title-row">
            <div class="card-title-group">
              <div class="icon-wrapper">
                <svg class="mission-icon unsolved" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path *ngIf="problem.name === 'Aqua-Infrastructure'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                  <path *ngIf="problem.name === 'Data Visualization'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                  <path *ngIf="problem.name === 'Marine Biology'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
              </div>
              <div>
                <h3 class="category-name">{{ problem.name }}</h3>
                <div class="progress-info">
                  <span class="progress-text">{{ getSolvedCount(problem) }}/{{ problem.mission.length }} Complete</span>
                  <div class="progress-dots">
                    <div *ngFor="let mission of problem.mission" 
                         class="progress-dot"
                         [ngClass]="{'completed': mission.solved}"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="score-badge">
              <svg class="score-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
              <span class="score-value">{{ problem.score }}</span>
            </div>
          </div>
          <p class="description">{{ problem.description }}</p>
        </div>

        <div class="missions-section" [class.expanded]="problem.expanded">
          <div class="divider"></div>
          <div class="missions-list">
            <div *ngFor="let mission of problem.mission" 
                 class="mission-card" 
                 (click)="navigateToMission($event, mission.id)">
              <div class="mission-header">
                <div class="mission-title-group">
                  <svg class="mission-icon" [ngClass]="mission.solved ? 'solved' : 'unsolved'" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path *ngIf="mission.solved" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    <path *ngIf="!mission.solved" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                  <h4 class="mission-name">{{ mission.name }}</h4>
                </div>
              </div>
              <p class="mission-effect">{{ mission.effect }}</p>
              <div class="mission-stats">
                <span class="stat">Difficulty: {{ mission.difficulty }}</span>
                <span class="stat attempts">Attempts: {{ mission.remainingAttempts }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="expand-indicator" *ngIf="!problem.expanded">
          â–¼
        </div>
      </div>
    </div>

    <ng-template #loadingTemplate>
      <p class="loading-text" *ngIf="loading">Loading quest data...</p>
      <p class="error-text" *ngIf="!loading && problem.length === 0">No problem found.</p>
    </ng-template>
  </main>
</div>